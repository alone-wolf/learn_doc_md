# 第二讲

## 操作系统的基本特性

### 并发 Concurrence

* 两个或两个以上的事物在同一时间间隔内发生
* 并行性：两个或多个事件在同一时刻发生
* 并发性：两个或多个事件在同一时间间隔内发生
* 在多道程序环境下，并发性是指在一段时间内，宏观上有多个程序在同时运行。
* 单处理机系统中，每一时刻仅能有一道程序执行，微观上这些程序只能是分时的交替执行（并发执行）
* 多处理机系统中，这些并发执行的程序可被分配到多个处理机上，实现并行执行
* 进程
  * 在操作系统中引入进程，是为了使多个程序能并发执行
  * 系统必须分别为每个程序建立进程Process
  * 简单来说：进程是指在系统中能独立运行并作为资源分配的基本单位，它是由一组机器指令、数据和堆栈等组成的，是一个能独立运行的活动实体。多个进程之间可以并发执行和交换信息。一个进程在运行时需要一定的资源，如CPU、存储空间及I/O设备等。 
  * 进程是一个重要的概念，引入了进程，多道程序（多道批处理系统、分时系统、实时系统中）才能并发执行。
* 线程
  * 一个进程中包含若干个线程，他们可以利用进程拥有的资源。通常将进程作为分配资源的基本单位，线程作为独立运行和独立调度的基本单位
  * 线程比进程更小，基本上不拥有系统资源，对他的调度付出的开销会小得多，能高效地提高系统内多个程序间并发执行的程度
  * 引入线程以便进一步提高系统的并发性，并将其视作：现代操作系统的一个重要标志

### 共享

* 系统中的软硬件资源在其上的供多个并发执行的进程/线程程序共同享用
  * 根据资源属性不同，进程对资源共享的方式也不同
  * 互斥共享--某时间内只允许一个进程访问，该进程访问完了，别人才可访问
    * 系统中的某些资源，打印机等，一段时间内只允许一个进程/线程访问
    * 临界资源（独占资源）：在一段时间内只允许一个进程访问的资源
    * 大多数物理设备（硬件）
    * 某些软件使用的栈/变量/表格
  * 同时访问--某时间段内，允许多个进程同时访问
    * 允许在一段时间内由多个进程同时访问，不会引起混乱
    * 这里所谓的同时，往往是宏观上的，而在微观上，这些进程可能是交替得对该资源进行访问
    * 比如 磁盘设备 一些重入码编写的文件，即若干个用户同时访问该文件
* 并发和共享是操作系统的两个最基本的特征，又是互为存在的条件

### 虚拟 Virtual

* 通过某种技术手段把一个物理上的实体，变成多个逻辑上的对应物
* 使用虚拟技术实现虚拟。
* OS中利用了多种虚拟技术，分别用来实现虚拟处理机，虚拟内存，虚拟外部设备，虚拟信道等
* 在虚拟处理机技术中，是通过多道程序设计技术，让多道程序并发执行的方法，来分时使用一台处理机的。此时， 虽然只有一台处理机，但它能同时为多个用户服务，使每个终端用户都认为是有一个CPU在专门为他服务（分时系统）。也就是说，利用多道程序设计技术，把一台物理机的CPU虚拟为多台逻辑上的CPU，在每台逻辑处理机上运行一道程序，把用户所感觉到的CPU称为虚拟处理机
* 虚拟存储器技术 将一台机器的物理存储器变为虚拟存储器，以便从逻辑上来扩充存储器的容量（具有请求调入和置换功能的存储器管理）把用户感觉到的存储器成为虚拟存储器
* 虚拟设备技术，将一台物理IO设备虚拟成为多台逻辑上的IO设备，并允许每个用户占用一台逻辑上的IO设备，将临界资源转变成，一段时间内允许多个用户同时访问的共享设备，主要通过分时使用的方法。。显然速度是1/n

### 异步 Asynchronism

* 也称随机性，是指系统中各种事件的发生顺序是不确定的
* 在多道程序环境下，允许多个进程并发执行， 但只有进程在获得所需的资源后方能执行。
* 进程是以人们不可预知的速度向前推进，此即进程的异步性
* 但只要OS中配备有完善的进程同步机制，且运行环境相同，作业经多次运行，都会获得完全先沟通的结果。因此，异步运行方式是允许的，是操作系统的一个重要特征



## 操作系统的结构设计

我们将第一到第三代的OS结构，称为传统的OS结构
### 无结构/整体系统结构
### 模块化结构 20世纪60年代提出
* 操作系统
  * 进程模块
    * 进程控制子模块
    * 进程调度
    * 。。。
  * 存储管理器
    * 内存分配子模块
    * 内存保护子模块
  * 文件管理
    * 磁盘管理
    * 目录管理
    * 。。。
* 模块化OS的优点
  * 提高了OS设计的正确性，可理解性，可维护性
  * 增强了OS的可适应性
  * 加速了OS的开发过程
* 缺点
  * 开始设计OS时，对模块的划分以及对接口的规定并不精确，并且可能存在错误，因而很难保证按此规定所设计出的模块会完全正确，这将使在把这些模块装配成OS时发生困难
  * 从功能观点来划分模块时，未能将共享资源和独占资源加以区别
  * 由于管理上的差异，又会使模块间存在着复杂的依赖关系使OS结构变得不清晰

### 分层式OS结构
### 把微内核OS结构称为现代OS结构

#### 足够小的内核包含

1. 与硬件处理密切相关的部分
2. 一些较基本功能
3. 客户与服务器之间的通信

	* 这些OS最基本的部分只是为构建通用OS提供一个重要基础，这样就可以确保把操作系统内核做得很小。

#### 客户/服务器模式 Client-Server Model

* 服务器进程和客户进程都运行在用户态，通过核心态进行数据交换
* 优点
  * 提高了系统的灵活性和可扩充性
  * 提高了OS的可靠性
  * 可运行于分布式系统中

  * 微内核的基本功能
    * 微内核所提供的功能，通常都是一些最基本的功能，如进程管理、存储器管理、进程间通信、 低级I/O功能。
      * 进程管理
      * 存储器管理
      * 进程通信管理
      * IO设备管理
    * 微内核结构存在的问题
      * 在完成一次客户对OS提出的服务请求时，需要利用消息实现多次交互和进行用户/内核模式及上下文的多次切换

## 操作系统的主要功能

### 处理机管理功能

* 任务：
  * 对处理机的分配和运行实施有效管理
  
  * 在多道程序环境下，处理机的分配和运行以进程为单位，因此对处理机的管理即对进程的管理
  
#### 进程控制

  * 在传统的多道程序环境下，进程控制的主要功能
    * 为作业创建进程，为进程分配资源
    * 控制进程在运行过程中的状态转换
    * 撤销已结束的进程，回收资源
  * 在现在OS中，进程控制还应有
    * 为一个进程创建若干个线程的功能
    * 撤销/终止已完成任务的线程的功能
#### 进程同步
  * 进程同步的主要任务是为多个进程/线程的运行进行协调，使多个进程能够有条不紊的运行
    * 进程互斥方式：各进程/线程在对临界资源进行访问时，应采用互斥方式
    * 进程同步方式。指在相互合作去完成共同任务的各进程/线程间，由同步击缶对他们的执行次序加以协调
    * 为了实现进程同步，系统中必须设置进程同步机制。实现进程同步常用的机制是信号量机制
#### 进程通信
  * 进程通信是指在多道程序环境下，并发的进程/线程如果相互合作去完成一个共同的任务，那么相互之间又往往需要交换信息
* 调度
  * 传统的操作系统中，包括作业调度和进程调度两种
    * 作业调度的基本任务是
      * 1. 从后备队列（在外存）中按照一定的算法，选择出若干个作业
      * 2. 为他们分配其必须的资源，首先是分配内存
      * 3. 在将他们调入内存后，便分别将他们建立进程，使他们都成为可能获得处理机的就绪进程
      * 4. 然后按照一定的算法将他们插入就绪队列
    * 进程调度的任务
      * 1. 从进程的就绪队列（在内存）中选出一新进程
      * 2. 把处理机分配给他，并为它设置运行现场（处理器各寄存器的值），使其投入运行
      * 在多线程OS(现代OS)中，通常是把线程作为独立运行和分配处理机的基本单位，为此，须把就绪线程排成一个队列，每次调度时，是从就绪线程队列中选出一个线程，把处理机分配给它。
### 存储器管理功能

  * 任务
    * 方便用户使用内存
    * 提高内存的利用率
    * 从逻辑上扩充内存
  * 功能
    * 内存分配
      * 静态分配方式
        * 每个作业的基本内存空间是在作业装入时确定的，在作业装入后的整个运行期间
          * 不允许该作业再申请新的内存控件
          * 也不允许作业再内存中移动
      * 动态分配方式
        * 每个作业所要求的基本内存空间，也是在作业装入时确定的
          * 允许作业再运行过程中，继续申请新的附加内存空间，以适应程序和数据的动态增长
          * 也允许作业在内存中移动
    * 为了实现内存分配，在内存分配的机制中应具有这样的结构和功能
      * 内存分配数据结构：用于记录内存空间的使用情况，作为内存分配的依据
      * 内存分配功能： 内存分配算法
      * 内存回收功能： 内存回收算法
    * 地址映射
      * 一个应用程序经编译后，通常会形成若干个目标程序；这些目标程序再经过链接便形成了可装入程序
      * 地址空间与内存空间  逻辑地址与物理地址
        * 这些程序的地址都是从0开始的，程序中的其他地址都是相对于起始地址计算的；由这些地址所形成的地址范围称为“地址空间”，其中的地址称为“逻辑地址”或“相对地址”
        * 由内存中的一系列单元所限定的地址范围称为”内存空间“，其中的地址为“物理地址”
      * 在多道程序环境下，每道程序不可能都从0开始装入内存，这就致使地址空间内的逻辑地址和内存空间中的物理地址不相一致。使程序能正常运行，存储器管理必须提供地址映射功能，以将地址空间中的逻辑地址转移为内存空间中与之对应的物理地址。该功能应在硬件的支持下完成。
    * 内存保护
      * 内存保护的主要任务是确保用户程序都只在自己的内存空间内运行，彼此互不干扰
      * 为了确保每道程序都只在自己的内存区中运行，必须设置内存保护机制
    * 内存扩充
      * 存储器管理中的内存扩充任务，并非是去扩大物理内存的容量，而是借助于虚拟存储技术，从逻辑上去扩充内存容量
      * 为了能在逻辑上扩充内存，系统必须具有内存扩充机制，用于实现如下功能
        * 请求调入功能
        * 置换功能

### 设备管理功能
  * 设备管理用于管理计算机系统中所有的外围设备，设备管理应具有
#### 缓冲管理
* 缓冲管理是为了解决CPU运行的高速性和IO低速性之间的矛盾
* 最常见的缓冲机制
  * 单缓冲
  * 双缓冲机制
  * 公用缓冲池机制
#### 设备分配
* 设备分配的基本任务是根据用户进程的IO请求、系统的现有资源情况以及按照某种设备分配策略，为之分配所需要的设备。如果在IO设备和CPU之间，还存在着设备控制器和IO通道时，还需为分配出去的设备分配相应的控制器和通道
  * 为了实现设备分配
    * 系统中应设置相应的数据结构
    * 针对不同的设备类型而采用不同的设备分配方式
    * 对于独占设备(临界资源)应考虑到该设备被分配出去后，系统是否安全
    * 设备的回收
#### 设备处理
 设备处理程序 又叫 设备驱动程序，基本任务是用于实现CPU和设备控制器之间的通信
* 任务
  * 完成用户程序请求的IO操作，为用户程序分配IO设备
  * 提高外部设备的利用率
  * 尽可能得提高IO速度
  * 方便用户使用外部设备
### 文件管理功能
  * 任务
    * 大量的信息以文件的形式放在外存，对信息的管理也就是对文件的管理 
  * 功能
#### 文件存储空间的管理
* 由文件系统对诸多文件及文件的存储空间，实施统一的管理。其主要任务是：
  * 为每个文件分配必要的外存空间
  * 提高外存利用率
  * 能有助于提高文件系统的运行速度
* 为此：
  * 系统应设置相应的数据结构
  * 对存储空间（外存）进行分配
  * 对存储空间（外存）进行回收
#### 目录管理
* 由系统为每个文件建立一个目录项。目录项包括文件名、文件属性、文件在磁盘上的物理位置等。
* 由若干个目录项又可构成一个目录文件
* 任务
  * 实现方便的按名存取
  * 实现文件的共享
  * 提供快速的目录查询
#### 文件的读写管理与保护
* 文件的读写管理
* 文件的读写过程
* 根据用户给出的文件名去检索文件目录，从而获取文件在外存中的位置
* 利用文件读写指针进行读写，读写完成后修改文件的读写指针
* 文件保护
### 操作系统与用户之间的接口
  * 操作系统接口
    * 命令接口
      * 联机命令接口
      * 脱机命令接口
      * 图形用户界面（命令接口的改版）
    * 程序接口
      * 也称系统调用

