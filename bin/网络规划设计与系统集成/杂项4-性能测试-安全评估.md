# 网络测试与运行维护

<img src="%E6%9D%82%E9%A1%B94.assets/image-20200607174733014.png" alt="image-20200607174733014" style="zoom:80%;" />

## 网络性能及指标

### 1 什么是网络性能

* 对于最终用户来说，响应时间是用于判断网络性能质量高低的一个基本手段。对于网络管理员来说，他们所关心的就不只是响应时间，还有网络的资源利用率
* 随着访问网络的用户数目的增多，网络服务器将使用更多的CPU、输入/输出（I/O）和内存来处理这些负载。最终，这些资源中的一部分将会达到使用极限
* 这就意味着，系统将不能有效地处理所有请求，迫使其中的一些请求暂缓处理。在多数情况下，计算机的CPU将是第一个使用极限的组件。当服务器资源达到使用极限后，最终的后果就是增加了响应时间。缩放能力允许网络通过提供更多的资源处理请求，从而处理额外的负载

### 2 网络性能指标内容描述

<img src="%E6%9D%82%E9%A1%B94.assets/image-20200607175018778.png" alt="image-20200607175018778" style="zoom:80%;" />

### 3 网络性能标准

* 响应时间

* 所需的并行用户数量

* 成本

* 标准与峰值

* 压力造成的降级

* 可靠性

#### 测试目的

性能与缩放性测试的目的是

不同的负载条件下监视和报告网络的行为。这些数据在稍后将用来分析网络的运行状态，并根据对额外负载的期望值安排今后的发展。根据所需要的容量和网络目前的性能，还可以用这些数据计算与今后项目的发展计划有关的成本 

#### 测试类型

* 基准性能测试
* 负载测试
* 压力测试
* 可靠性测试

#### 与测试相关的配置

* 服务器硬件和服务器数量
* 数据库大小
* 测试客户机在网络中的位置
* 两种影响负载的因素
  * SSL与非SSL
  * 图像检索

#### 测试方法

* 客户机
  * 这个系统用于模拟多个用户访问网络，通常通过负载测试工具进行测试，
  * 可以使用测试参数（如用户数量）进行配置，从而得到响应时间的测试结果（最少/最多/平均）。
  * 负载测试工具可以模拟处于不同层的用户，从而有效地跟踪和报告响应时间。
  * 此外，为了确保客户机没有过载，而且服务器上有足够的负载，应当监视客户机CPU的使用情况

* 服务器
  * 网络的Web应用程序和数据库服务器应当使用某个工具来监视，
  * 如Windows Server 2003 Monitor（性能监视器）。
  * 有一些负载测试工具为了完成这个任务还内置了监视程序。
  * 对全部服务器平台进行性能测试的重点在于以下几个方面：CPU，占全部处理器时间的百分比；
  * 内存，用字节数（千字节）和每秒出现的页面错误率表示；
  * 硬盘，占硬盘时间的百分比；
  * 网络，每秒的总字节数
* web服务器
  * 除了“服务器”中介绍的几项之外，
  * 所有Web服务器还应当包含“文件字节/秒”、“最大的同时连接数目”和“误差测量”等性能测试项目
* 数据库服务器
  * 所有数据库服务器都应当包含“访问记录/秒”
  * 和“缓存命中率”这两种性能测试项目。
* 网络
  * 为了确保网络没有成为网络的瓶颈，监视网络网络以及其中任何子网的带宽是非常重要的。
  * 可以使用各种软件包或者硬件设备（如LAN分析器）来监视网络。
  * 在交换式以太网中，因为每两个连接彼此之间相对独立，所以，必须监视每个单独服务器连接的带宽

#### 局域网可靠性测试

* 可用的千字节
  * 在测试过程中应当保持相对稳定。该数值一旦降低，就表明系统正在消耗内存，并将产生页故障
* 页面故障率/秒
  * 这是评估系统性能的另一个标准。
  * 当页面故障不断增加，或者保持较高的数目时，则表明系统耗费了太多的内存。
  * 通过将内存换出到磁盘，可解决内存不足的问题
* 错误
  * 为了指出系统的可靠性问题，应当检查在系统测试过程中出现的错误。
  * 错误的数量非常少，则说明可靠性良好。
  * 但是，当错误的数量不断增加时，就表现网络的可靠性出现了问题
* 数据库访问日志和表大小
  * 数据库访问日志经过长时间的使用将会增加。
  * 要确保访问日志的维护正确，这意味着访问日志的截取时间间隔是有规律的，数据库表的大小将不会超过预期的极限。

#### 网络吞吐率测试

* 测试端与广域网或局域网间的吞吐量
* 测试跨越广域网连接的IP性能，并用于对照服务等级协议（SLA），将目前使用的广域网链路的能力和承诺的信息速率（CIR）进行比较
* 在安装VPN时进行基准测试和拥塞测试
* 测试网络设备不同配置下的性能，从而优化和评估相关设置
* 在网络故障诊断过程中，帮助判断网络的问题是局域网的问题还是广域网的问题，从而快速定位故障
* 在日常维护中，定期检测广域网的带宽
* 在增加网络设备、站点、应用时，检测其对广域网链路的影响

## 网络性能改善

* 网络性能改善技术措施 调整和优化服务器内存  服务器资源优化  建立与完善网络配置文档

### 服务器负载平衡

* DNS（Domain Name Server，域名服务器）循环法是平衡负载的最简单方法，也是目前最流行的服务器负载平衡的一项功能。服务器的一个域名（如www.yoursite.com），可使用多个IP地址进行配置。每当用户访问www.yoursite.com时，DNS服务器就用清单中下一个IP地址进行响应。当到达清单的末尾时，DNS服务器将会从IP地址清单开始处重新分配。人们把这种方法叫做“IP地址轮循”法。这种方法类似数据结构的环形队列

* 硬件负载平衡方法比简单的循环方法更有效。这主要是由于负载平衡算法更复杂，能够有效地将负载分配到服务器上
* Windows Server 2003 企业版的“集群管理器”可用于手动平衡服务器的工作负荷，并根据计划维护发布服务器。还可以从网络中的任何位置监控集群、所有节点及资源的状态

### 网络性能改善技术措施

#### 网络程序与数据库服务器

* 排队
  * （Inline）执行。可以减少系统开销，从而减少响应时间
* CSS
  * 采用CSS所传输的数据减少了，能够减少页面数据传回到客户所需的时间
* SSL
  * 采用SSL协议将占用大量的处理器时间和网络带宽，但能够提高安全性
* HTTP压缩
  * 可以减少所传输的数据大小，由此缩短响应时间
* 页面预生成
  * 可以节省处理时间，这是因为每一个用户请示都只需检索一个页面，既不调用整个业务逻辑，也不访问数据库
* 数据库设计
  * 这是可以改进的，主要通过采用优化使用索引、存储过程以及反向规范化技术等方法，来缩短所需的处理时间

### 调整和优化服务器内存

#### 物理内存的调整和优化

* 减少显示系统的颜色数，这能使系统占用的内存大大减少。如显示颜色数一直使用，则这部分内存将长期占用
* 降低显示系统的分辨率，这与显示颜色数是一样的道理
* 不要使用“墙纸”或大型的屏幕保护程序
* 关闭服务器没有使用的或者不必要的服务，以便让出更多的内存供应用程序使用，同时也为网络和处理器的工作减少了许多负担
* 删除一些不必要的协议
* 在硬件方面，内存应当使用完全一致的芯片。混用不同厂家甚至不同速度的芯片将是非常危险的，不仅是能使系统性能下降，还会产生一些不可预料的后果，直到系统不能工作

#### 虚拟内存的调整和优化

* 系统必须有足够的内存来存储所有正在执行的线程
* 增加物理内存。Windows 2003可以充分利用系统提供的一切物理内存，系统拥有的物理内存越多，用于页面交换所花费的时间就越少
* 页面交换得越快，对系统响应性能的影响就越低。要想加速页面交换过程，Windows 2003 Server支持其虚拟内存页面交换文件的同时写入多块硬盘
* Windows 2003 Server允许将虚拟内存交换文件，分布于同一硬盘的不同卷之间。事实上，这种配置由于迫使驱动器磁头在交换期间的移动次数大大超过了正常的移动次数，所以增加了交换时间。因此，对每块物理磁盘建议用户仅设置一个交换文件

### 服务器资源优化

* 优化代码算法
  * 导致过度使用CPU的原因，通常是算法设计比较低效。低效算法（尤其是在循环计算时）通常占用大量的CPU资源。重新构建代码，并对其优化，可以减少算法占用的CPU资源
* 消除内存泄漏
  * 当系统组件分配了内存，但随后没有释放内存时，就会产生内存泄漏。内存泄漏一般不会消耗大量的内存资源。但在一些情况下，由于换页或者为留出足够的空间来完成其他工作，将所浪费的内存页交换到磁盘中时，内存泄漏会显著降低服务器的性能。有许多工具可用于确定在源代码级别上发生内存泄漏的位置
* 降低磁盘的使用率
  * 物理磁盘，包括RAID阵列（冗余独立磁盘阵列）的访问速度与物理RAM的访问速度比较起来，前者的速度相当慢。
  * 当系统组件揭示出磁盘时间比较高时，就应当考虑将数据载入到内存中，从内存访问它，而不是访问磁盘。
  * 从性能的角度考虑，如果设备有足够多的内存可以保存数据，而不会出现换页现象，那么，最好是从内存中读取数据，而不是从硬盘中读取数据

#### 建立完善网络配置文档

* 每台交换机和路由器的硬件配置
  * 包括处理器、内存、接口模块的类型，安装的板卡、端口及它们的设置，其他硬件情况
* 每台交换机和路由器的软件配置
  * 包括系统软件的版本、运行配置文件及更改说明文档
* 网络物理拓扑和逻辑拓扑
  * 包括网络整体物理拓扑结构图、逻辑结构图、综合布线施工图表、以及网络施工和验收的技术文档
* 每台服务器和工作站的硬件配置
  * 包括处理器、内存、软盘和硬盘的类型，安装的板卡及它们的设置，其他硬件情况
* 每台服务器的软件配置
  * 包括操作系统的版本，一些重要的配置文件的打印结果和备份拷贝。如CONFIG.SYS，SHELL.CFG，WIN.INI，SYSTEM.INI，Windows 2000的系统注册表，目录结构的打印结果，应用程序的清单，包括版本和注册号，及其他所有的特殊软件，如设备驱动程序
* 备份规划
  * 确定备份系统在何种备份介质中，该备份是在何时进行的，备份存放在什么位置等

## 网络故障检测与排除

### 故障管理的功能

* 保持与检查差错录入
* 接受差错检测通知并对其采取动作
* 跟踪并标识故障
* 完成诊断测试序列
* 校正与排除故障

### 故障管理的方法和步骤

* 发现问题
* 划定界限
* 追踪可能的途径
* 执行一种方法
* 检验成功
* 做好收尾工作

### 设备除尘与防静电

* 驱除尘埃和其他污染
* 检查机器连接
* 防止静电

## 网络性能与安全性评估

### 评估基本知识

#### 评估目标

#### 评估原则

* 整体性原则
  * 从评估内容、业界标准、应用需求分析和服务规范等多个角度保证评估测试的整体性和全面性
* 规范性原则
  * 严格遵循业界项目管理和服务质量标准和规范
* 有效性原则
  * 从成功经验、人员水平、政府信誉、工具、项目过程等多个方面保证整个过程和结果的有效性
* 最小影响原则
  * 在项目管理和工具技术方面，使评估对系统造成的影响降低到最低限度
* 保密性原则
  * 保证政务网络应用系统和业务系统数据的安全性，避免政务数据的泄露和系统受到侵害

#### 评估内容

* 按照网络资源划分
  * 评估内容包括对网络结构、网络传输、网络交换、业务应用、数据交换、数据库运行、应用程序运行、安全措施（包含设备软件和制度）、备份措施（包含设备软件和制度）、管理措施（包含设备软件、制度和人员）、主机/服务器处理能力、客户端处理能力等方面的评估
* 按照评估项目划分
  * 评估内容包括网络协议分析、系统稳定评估、网络流量评估、网络瓶颈分析、网络业务应用评估、安全漏洞评估、安全弱点评估等方面
* 按照网络故障划分
  * 评估内容包括网络接口层（物理、数据链路）故障、网络层故障和网络应用（协议）层故障等方面的评估

#### 评估策略与流程

##### 评估策略

在技术上采用的是从网络信息系统的底层到高层、实测和预测相结合的综合评估；

在资源划分上采用的是由大到小、逐步细化、纵横关联的模型；

要充分考虑网络系统运行维度和网络信息资源的关系

##### 流程

根据评估目标、原则和策略，电子政务系统评估也可按照图所示的评估流程图实施评估

<img src="%E6%9D%82%E9%A1%B94.assets/image-20200607183153801.png" alt="image-20200607183153801" style="zoom: 80%;" />

### 网络性能评估

* 网络的性能评估是保证网络信息高性能、高可靠性、高可用性、高效率运转的基本手段。网络的健壮指数越大说明它的生命力就越强，它所能够承载的信息量就越大。一个健壮性指数高的网络是保证业务运行和应用的必要前提
* 在整个网络信息系统中，网络架构、网络传输、业务应用、数据交换、数据库运行、应用程序运行、安全措施、备份措施、管理措施、主机/服务器处理及客户端处理等，这一系列的元素都是相互关联和相互影响的
* 这些元素之间的关系往往是比较复杂的，“牵一发而动全身”，每一项元素的性能下降或者受到安全威胁，都将对整个Web网站信息系统造成影响。尤其是对于那些处于关键业务的元素（如Web网站流量）更是不允许性能下降和存在安全隐患

### 网络安全性评估

#### 安全风险分析

#### 安全评估方法

网络系统风险分析的方式：

* 问卷调查、
* 访谈、
* 文档审查、
* 黑盒测试、
* 操作系统的漏洞检查和分析、
* 网络服务的安全漏洞和隐患的检查和分析、
* 抗攻击测试和综合审计报告

其中最主要的就是利用漏洞扫描软件对网络系统进行扫描分析

#### 安全评估步骤

* 找出漏洞

* 分析漏洞
* 降低风险

#### 安全评估进一步的工作

* 做好万一遭安全性入侵的准备
* 测试弱点
* 评估与再评估

